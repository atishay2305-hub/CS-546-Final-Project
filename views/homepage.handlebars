<h1>Welcome {{userName}}</h1>

<h2>Your user ID is: {{userId}}</h2>


<a href="/profile">My Profile</a>

{{#each posts}}
    <div class="post-container">
        <h2>{{content}}</h2>
        <p>Category: {{category}}</p>
        <p>Created by: {{name}}</p>
        <p>Created at: {{created_Date}}</p>
        <p>Likes: {{likes}}, Dislikes: {{dislikes}}</p>
        <div class="comments-container">
            <h3>Comments:</h3>
            {{#each comments}}
                <div class="comment-container">
                <p>{{text}}</p>
                <p>Posted by: {{author}}</p>
                <p>Posted at: {{created_Date}}</p>
                </div>
        {{/each}}
            <form class="comment-form" id="comment-form" action="/add-comment" method="POST">
                <input type="hidden" name="postId" value="{{_id}}">
                <label for="comment-text">Add a Comment:</label>
                <input type="text" name="commentText" id="comment-text" required>
                <input type="submit" value="Submit">
            </form>
        </div>
        {{#if deletable}}
            <button class="delete-btn" onClick ="deletePost('{{_id}}')" data-post-id="{{_id}}">Delete</button>
        {{/if}}
    </div>
{{/each}}

<script>
function deletePost(id) {
  fetch(`/posts/${id}`, {
    method: "delete",
    headers: {
      Accept: 'application/json, text/plain, */*',
      "Content-type": 'application/json'
    },
  })
  .then(response => {
  if (response.ok) {
    alert('Post deleted successfully');
    window.location.href = '/homepage';
  } else {
    throw new Error('Network response was not ok');
  }
})
  .catch(error => {
    alert(error.message || "Something went wrong.");
  })
  .then(() => {
    console.log('This will run after either success or failure');
  });
}

cForm = document.getElementById('comment-form');

cForm.addEventListener('submit',function(event){
    event.preventDefault();

    cForm.submit();

})
</script>


